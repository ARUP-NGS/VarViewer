package varviewer.client;

import java.util.List;

import varviewer.client.varTable.VarTable;
import varviewer.shared.Interval;
import varviewer.shared.Variant;
import varviewer.shared.VariantRequest;

import com.google.gwt.core.client.EntryPoint;
import com.google.gwt.core.client.GWT;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.rpc.AsyncCallback;
import com.google.gwt.user.client.ui.HorizontalPanel;
import com.google.gwt.user.client.ui.RootPanel;
import com.google.gwt.user.client.ui.VerticalPanel;

/**
 * Entry point classes define <code>onModuleLoad()</code>.
 */
public class VarViewer implements EntryPoint {
	

	  public void onModuleLoad() {

		  initComponents();
		loadVariants();

	  }
	  
	  private void initComponents() {
		  VerticalPanel mainPanel = new VerticalPanel();
		  
		  HorizontalPanel filtersAndTablePanel = new HorizontalPanel();
		  FiltersPanel filtersPanel = new FiltersPanel();
		  filtersAndTablePanel.add(filtersPanel);
		  
		  varTable = new VarTable();
		  
		  filtersAndTablePanel.add(varTable);
		  mainPanel.add(filtersAndTablePanel);
		  
		  DetailsPanel detailsPanel = new DetailsPanel();
		  //details panel listens to variant selection events generated by the varTable
		  varTable.addVariantSelectionListener(detailsPanel); 
		  mainPanel.add(detailsPanel);
		  
		  RootPanel.get().add(mainPanel);		  
	  }
	  
	  private void loadVariants() {
		
		  VariantRequest req = new VariantRequest();
		  req.addSample("foo");
		  req.addInterval("1", new Interval(1000000, 3000000));
		  varRequestService.queryVariant(req, new AsyncCallback<List<Variant>>() {

			@Override
			public void onFailure(Throwable caught) {
				Window.alert("Error retrieving variants : " + caught.toString());
			}

			@Override
			public void onSuccess(List<Variant> result) {
				varTable.setVariants(result);
			}
			  
		  });
	}

	  VarTable varTable = null;
	VarRequestServiceAsync varRequestService = (VarRequestServiceAsync) GWT.create(VarRequestService.class);
}

